function Res = HIV_EKF_projection(Data,Model,m,Cov,NbIts,IndTime,Parameters)

    mpred = m;
    TStep = Parameters.ComputationTStep;

    
    deltabetas = zeros(1,NbIts);
    record = zeros(10,NbIts);
    
    if or(strcmp(Parameters.DiffusionType,'Bertallanfy')
        m = Parameters.BRmm1.Value + 1;
        mu = Parameters.BRmu.Value;
        k = Parameters.k;
    else
%         disp('Unknown Diffusion')
%         die
    end
        
    MuFm1 = Parameters.MuFm1.Value;
    Alpham1 = Parameters.Alpham1.Value;
    BetaMF = Parameters.BetaMF.Value;
    CF1 = Parameters.CF1.Value;
    BetaFM = Parameters.BetaFM.Value;
    CF2 = Parameters.CF2.Value;
    eHIV = Parameters.eHIV.Value;
    NbContactsForMen = Parameters.NbContactsForMen;
    MuMm1 = Parameters.MuMm1.Value;
    
    for IndDiscr = 1:NbIts
        
%         if sum(mpred(1:8)<0)
%             'stop'
%         end
        
%         mpred(1:8) = max(0,mpred(1:8));
        
       
        mtemp = mpred;
        if strcmp(Parameters.DiffusionType,'Bertallanfy')
            mtemp(9) = min(-0.01,mtemp(9));
            beta = ((1-m)*mtemp(9)+mu^(1-m))^(1/(1-m));
        else
            beta = exp(mtemp(9))/(1+exp(mtemp(9)));
        end
        TotF1 = mtemp(1) + mtemp(2);
        TotF2 = mtemp(3) + mtemp(4);
        TotM  = mtemp(5) + mtemp(6);
        mpred(1) = mpred(1) + ( MuFm1^-1*(TotF1) + Alpham1^-1*mtemp(2) - BetaMF*CF1*(1-eHIV*beta)*mtemp(1)*mtemp(6)/TotM-MuFm1^-1*mtemp(1))*TStep;
        mpred(2) = mpred(2) + ( BetaMF*CF1*(1-eHIV*beta)*mtemp(1)*mtemp(6)/TotM - (MuFm1^-1 + Alpham1^-1)*mtemp(2))*TStep;
        mpred(3) = mpred(3) + ( MuFm1^-1*(TotF2) + Alpham1^-1*mtemp(4) - BetaMF*CF2*(1-eHIV*beta)*mtemp(3)*mtemp(6)/TotM-MuFm1^-1*mtemp(3))*TStep;
        mpred(4) = mpred(4) + ( BetaMF*CF2*(1-eHIV*beta)*mtemp(3)*mtemp(6)/TotM - (MuFm1^-1 + Alpham1^-1)*mtemp(4))*TStep;
        mpred(5) = mpred(5) + ( MuMm1^-1*(TotM) + Alpham1^-1*mtemp(6) - BetaFM*NbContactsForMen*(1-eHIV*beta)*mtemp(5)*(CF1*TotF1/(CF2*TotF2+CF1*TotF1)*mtemp(2)./TotF1+CF2*TotF2/(CF2*TotF2+CF1*TotF1)*mtemp(4)/TotF2)-MuMm1^-1*mtemp(5))*TStep;
        mpred(6) = mpred(6) + ( BetaFM*NbContactsForMen*(1-eHIV*beta)*mtemp(5)*(CF1*TotF1/(CF2*TotF2+CF1*TotF1)*mtemp(2)/TotF1+CF2*TotF2/(CF2*TotF2+CF1*TotF1)*mtemp(4)/TotF2) - (MuMm1^-1+Alpham1^-1)*mtemp(6))*TStep;
        mpred(7) = ((mpred(2) + mpred(4))/(TotF1+TotF2))*100; 
        mpred(8) = ((mpred(6))/(TotM))*100; 
        
     
        if strcmp(Parameters.DiffusionType,'Bertallanfy')
            mpred(9) = mtemp(9) - k*mtemp(9)*TStep;
        elseif strcmp(Parameters.DiffusionType,'Add')
            mpred(9) = mtemp(9);
        else
            disp('Unknown Diffusion')
            die
        end
        
        if not(isreal(mpred))
            '....'
        end

        if strcmp(Parameters.DiffusionType,'Bertallanfy')
            betader = ((1-m)*mpred(9)+mu^(1-m))^(m/(1-m));
        else
            betader = exp(mpred(9))/((1+exp(mpred(9)))^2);
        end
        Jacobian = zeros(10,10);
        Jacobian(1,1) =   - BetaMF*CF1*(1-eHIV*beta)*mtemp(6)/TotM-MuFm1^-1;
        Jacobian(1,2) =     Alpham1^-1 ;
        Jacobian(1,3) = 0;
        Jacobian(1,4) = 0;
        Jacobian(1,5) = 0;
        Jacobian(1,6) =   - BetaMF*CF1*(1-eHIV*beta)*mtemp(1)/TotM;
        Jacobian(1,7) = 0;
        Jacobian(1,8) = 0;
        Jacobian(1,9) =   - BetaMF*CF1*(-eHIV*betader)*mtemp(1)*mtemp(6)./TotM;
        Jacobian(2,1) =     BetaMF*CF1*(1-eHIV*beta)*mtemp(6)./TotM ;
        Jacobian(2,2) =   - (MuFm1^-1 + Alpham1^-1);
        Jacobian(2,3) = 0;
        Jacobian(2,4) = 0;
        Jacobian(2,5) = 0;
        Jacobian(2,6) =     BetaMF*CF1*(1-eHIV*beta)*mtemp(1)./TotM ;
        Jacobian(2,7) = 0;
        Jacobian(2,8) = 0;
        Jacobian(2,9) =     BetaMF*CF1*(-eHIV*betader)*mtemp(1)*mtemp(6)./TotM ;
        Jacobian(3,1) = 0;
        Jacobian(3,2) = 0;
        Jacobian(3,3) =  - BetaMF*CF2*(1-eHIV*beta)*mtemp(6)./TotM-MuFm1^-1;
        Jacobian(3,4) =    Alpham1^-1;
        Jacobian(3,5) = 0;
        Jacobian(3,6) =  - BetaMF*CF2*(1-eHIV*beta)*mtemp(3)./TotM;
        Jacobian(3,7) = 0;
        Jacobian(3,8) = 0;
        Jacobian(3,9) =  - BetaMF*CF2*(-eHIV*betader)*mtemp(3)*mtemp(6)./TotM;
        Jacobian(4,1) =  0;
        Jacobian(4,2) =  0;
        Jacobian(4,3) =  BetaMF*CF2*(1-eHIV*beta)*mtemp(6)./TotM ;
        Jacobian(4,4) =  - (MuFm1^-1 + Alpham1^-1);
        Jacobian(4,5) = 0;
        Jacobian(4,6) =   BetaMF*CF2*(1-eHIV*beta)*mtemp(3)./TotM ;
        Jacobian(4,7) = 0;
        Jacobian(4,8) = 0;
        Jacobian(4,9) =    BetaMF*CF2*(-eHIV*betader)*mtemp(3)*mtemp(6)./TotM ;        
        Jacobian(5,1) = 0;
        Jacobian(5,2) =  - BetaFM*NbContactsForMen*(1-eHIV*beta)*mtemp(5)*(CF1*TotF1./(CF2*TotF2+CF1*TotF1)./TotF1);
        Jacobian(5,3) = 0;
        Jacobian(5,4) =  - BetaFM*NbContactsForMen*(1-eHIV*beta)*mtemp(5)*(CF2*TotF2./(CF2*TotF2+CF1*TotF1)./TotF2);
        Jacobian(5,5) =  - BetaFM*NbContactsForMen*(1-eHIV*beta)*(CF1*TotF1./(CF2*TotF2+CF1*TotF1)*mtemp(2)./TotF1+CF2*TotF2./(CF2*TotF2+CF1*TotF1)*mtemp(4)./TotF2)-MuMm1^-1;
        Jacobian(5,6) =    Alpham1^-1;
        Jacobian(5,7) = 0;
        Jacobian(5,8) = 0;
        Jacobian(5,9) =  - BetaFM*NbContactsForMen*(-eHIV*betader)*mtemp(5)*(CF1*TotF1./(CF2*TotF2+CF1*TotF1)*mtemp(2)./TotF1+CF2*TotF2./(CF2*TotF2+CF1*TotF1)*mtemp(4)./TotF2);
        Jacobian(6,1) = 0;
        Jacobian(6,2) =  BetaFM*NbContactsForMen*(1-eHIV*beta)*mtemp(5)*(CF1*TotF1./(CF2*TotF2+CF1*TotF1)./TotF1) ;
        Jacobian(6,3) = 0;
        Jacobian(6,4) =  BetaFM*NbContactsForMen*(1-eHIV*beta)*mtemp(5)*(CF2*TotF2./(CF2*TotF2+CF1*TotF1)./TotF2) ;
        Jacobian(6,5) =  BetaFM*NbContactsForMen*(1-eHIV*beta)*(CF1*TotF1./(CF2*TotF2+CF1*TotF1)*mtemp(2)./TotF1+CF2*TotF2./(CF2*TotF2+CF1*TotF1)*mtemp(4)./TotF2) ;
        Jacobian(6,6) =  - (MuMm1^-1+Alpham1^-1);
        Jacobian(6,7) = 0;
        Jacobian(6,8) = 0;
        Jacobian(6,9) =  BetaFM*NbContactsForMen*(-eHIV*betader)*mtemp(5)*(CF1*TotF1./(CF2*TotF2+CF1*TotF1)*mtemp(2)./TotF1+CF2*TotF2./(CF2*TotF2+CF1*TotF1)*mtemp(4)./TotF2);
        Jacobian(7,:) = ((Jacobian(2,:)+Jacobian(4,:))/(TotF1+TotF2))*100;
        Jacobian(8,:) = (Jacobian(6,:)/(TotM))*100;

        
        if strcmp(Parameters.DiffusionType,'OUD')
            Jacobian(9,9) = -Parameters.KappaOU.Value;
        elseif strcmp(Parameters.DiffusionType,'IBM')
            Jacobian(9,10) = 1;
        elseif strcmp(Parameters.DiffusionType,'Bertallanfy')
            Jacobian(9,9) = - k;
        end
        
        Q = zeros(10,10);
        if strcmp(Parameters.DiffusionType,'Bertallanfy')
            Q(9,9) = (Parameters.SigmaRW.Value*mpred(9))^2;
%             Q(9,9) = (Parameters.SigmaRW.Value/(mu*exp(mtemp(9))/(1+exp(mtemp(9)))^2))^2;
        elseif strcmp(Parameters.DiffusionType,'Add')
            Q(9,9) = (Parameters.SigmaRW.Value)^2;
        else
            die
        end
        Cov = Cov + (Jacobian*Cov+Cov*Jacobian'+Q)*TStep;
        record(:,IndDiscr)= mtemp;
        
%         mpred(1:8) = max(0,mpred(1:8));
    end
    
% try
%     Res.deltabetas = deltabetas;
% end
    Res.m = mpred;
    Res.Cov = Cov;
    Res.Model = Model;